# 介绍

[Introduction - Zustand (pmnd.rs)](https://zustand.docs.pmnd.rs/getting-started/introduction)   官方文档

相比于**redux** 简单很多，没有那么多模板代码，Zustand 的 API 更加简洁明了，学习成本较低

## **Zustand 优势**

1. **轻量级** ：Zustand 的整个代码库非常小巧，gzip 压缩后仅有 1KB，对项目性能影响极小
2. **简洁的 API** ：Zustand 提供了简洁明了的 API，能够快速上手并使用它来管理项目状态
3. **支持 TypeScript**： Zustand 支持 TypeScript，让项目更具健壮性
4. **可拓展性** : Zustand 提供了中间件 (middleware) 的概念，允许你通过插件的方式扩展其功能。中间件可以用于处理日志记录、持久化存储、异步操作等需求，使得状态管理更加灵活和可扩展
5. **性能优化**: Zustand 在设计时非常注重性能。它采用了高效的状态更新机制，避免了不必要的渲染。同时，Zustand 还支持分片状态和惰性初始化，以提高大型应用程序的性能。
6. **无副作用**: Zustand 鼓励无副作用的状态更新方式。它倡导使用 immer 库来处理不可变性，使得状态更新更具可预测性，也更易于调试和维护。

##  一 初始化项目

```bash
npx create-vite zustand-test  //选择 react  和 typescript
npm install --save zustand
```

## 二 写一段代码

在src目录下创建

```css
├── src
├── assets
├── store
│   └──initStore.ts // 创建一个store
├── App.tsx  
├── index.css  
└── main.tsx
```



```jsx
import { create } from 'zustand'

// TS类型声明
interface Stata {
  num: number
  userName: string[]
  setAddNum: () => void
  setUserName: (userName: string) => void
  setNum: (num: number) => void
}

export const initStore = create<Stata>((set) => ({
  num: 0,
  userName: ['张三', '李四', '王五', '赵六', '田七'],
  setAddNum: () => {
    set((state) => ({ num: state.num + 1 }))
  },
  setNum: (num) => set({ num }),
  setUserName: (user) => {
    set((state) => {
      return { userName: [...state.userName, ...user] }
    })
  },
}))
```

### 介绍一下

```jsx
// TS类型声明
interface Stata {
  num: number
  userName: string[]
  setAddNum: () => void
  setUserName: (userName: string) => void
  setNum: (num: number) => void
}
```

这段代码做了什么

> 对仓库的属性，方法进行类型声明

### 介绍一下

```jsx
export const initStore = create<Stata>((set) => ({
  num: 0,
  userName: ['张三', '李四', '王五', '赵六', '田七'],
  setAddNum: () => {
    set((state) => ({ num: state.num + 1 }))
  },
  setNum: (num) => set({ num }),
  setUserName: (user) => {
    set((state) => {
      return { userName: [...state.userName, ...user] }
    })
  },
}))
```

这段代码做了什么

> 声明了两个状态  num  userName
>
> 声明了三个方法  setAddNum  setNum  setUserName 

##  三 组件内部使用（方法或者状态）

```jsx
import { useState } from 'react'
import { initStore } from './store/initStore'

import './App.css'

function App() {
  const { num, setAddNum, setNum, setUserName, userName } = initStore()

  // 数字逻辑
  const num_data = (e: React.ChangeEvent<HTMLInputElement>) => {
    setNum(Number(e.target.value))
  }

  const addNum = () => {
    setAddNum()
  }

  // 用户名字逻辑
  const change_userName = (e: React.ChangeEvent<HTMLInputElement>) => {
    setUserName(e.target.value)
  }
  return (
    <>
      <h2>仓库数字：{num}</h2>
      <input
        type="text"
        onChange={(e: React.ChangeEvent<HTMLInputElement>) => num_data(e)}
      />
      <button onClick={addNum}>点击数字加一</button>

      <hr></hr>
      <h2>仓库用户名字：{userName}</h2>
      <input
        type="text"
        onChange={(e: React.ChangeEvent<HTMLInputElement>) =>
          change_userName(e)
        }
      />
    </>
  )
}

export default App
```

### 先去掉TS,分析一下代码

```tsx
import { initStore } from './store/initStore'

import './App.css'

function App() {
  const { num, setAddNum, setNum, setUserName, userName } = initStore()

  // 数字逻辑
  const num_data = (e) => {
    setNum(Number(e.target.value))
  }

  const addNum = () => {
    setAddNum()
  }

  // 用户名字逻辑
  const change_userName = (e) => {
    setUserName(e.target.value)
  }
  return (
    <>
      <h2>仓库数字：{num}</h2>
      <input type="text" onChange={(e) => num_data(e)} />
      <button onClick={addNum}>点击数字加一</button>

      <hr></hr>
      <h2>仓库用户名字：{userName}</h2>
      <input type="text" onChange={(e) => change_userName(e)} />
    </>
  )
}

export default App

```

> initStore()使用刚才创建的仓库，直接结构出来属性，方法，直接使用就可以了
>
> 可以看到非常简单方便

## 四 异步操作

```tsx
import { create } from 'zustand'

// TS类型声明
interface Stata {
  num: number
  userName: string[]
  setAddNum: () => void
  setUserName: (userName: string) => void
  setNum: (num: number) => void
}

export const initStore = create<Stata>((set) => ({
  num: 0,
  userName: ['张三', '李四', '王五', '赵六', '田七'],
  setAddNum: () => {
    set((state) => ({ num: state.num + 1 }))
  },
  setNum: (num) => set({ num }),
  setUserName: (user) => {
    set((state) => {
      return { userName: [...state.userName, ...user] }
    })
  },
  fetchItems: async () => {
    const response = await fetch('/api/items')
    const userName = await response.json()
    set({ userName })
  },
}))
```

这段代码异步操作

```tsx
fetchItems: async () => {
    const response = await fetch('/api/items')
    const userName = await response.json()
    set({ userName })
  },
```

组件内部使用

```tsx
import { useEffect } from 'react'
import useStore from './store'

function Items() {
  const items = useStore((state) => state.items)
  const fetchItems = useStore((state) => state.fetchItems)

  useEffect(() => {
    fetchItems()
  }, [fetchItems])

  return (
    <ul>
      {items.map((item) => (
        <li key={item.id}>{item.name}</li>
      ))}
    </ul>
  )
}

export default Items
```

## 五 zustand 中间件

### 数据持久化中间件

```tsx
import { create } from 'zustand'
import { persist } from 'zustand/middleware'

// TS类型声明
interface Stata {
  num: number
  userName: string[]
  setAddNum: () => void
  setNum: (num: number) => void
  setUserName: (user: string) => void
  fetchItems: () => void
}

export const initStore = create(
  persist(
    (set) => ({
      num: 0,
      userName: ['张三', '李四', '王五', '赵六', '田七'],
      setAddNum: () => {
        set((state: Stata) => ({ num: state.num + 1 }))
      },
      setNum: (num: number) => set({ num }),
      setUserName: (user: string) => {
        set((state: Stata) => {
          return { userName: [...state.userName, ...user] }
        })
      },
      fetchItems: async () => {
        const response = await fetch('/api/items')
        const userName = await response.json()
        set({ userName })
      },
    }),
    { name: 'my-store' }
  )
)

```

> ​	import { persist } from 'zustand/middleware'
>
> ​    包裹就可以实现持久化了

### Immer middleware

简化修改数据

```tsx
import { immer } from 'zustand/middleware/immer'
```

### **Devtools middle**

利用开发者工具 `调试/追踪` Store

使用方法包裹即可

```jsx
import { devtools, persist } from 'zustand/middleware'
```

